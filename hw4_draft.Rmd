---
title: "Stat 477 - HW 3"
author: "Jay Maxwell"
date: "2/8/2022"
output: 
  pdf_document:
    fig_caption: yes
    includes:
     in_header: my_header.tex
---  

```{r setup, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=80), 
                      tidy=TRUE, 
                      include=TRUE, 
                      echo=TRUE) 
                      #results="asis",
                      #fig.pos = "!", 
                      #out.extra = ""
library(plyr)                      
library(tidyverse)
library(kableExtra)
library(knitr)
library(epiDisplay)

## FOLLOWING CODE PROVIDED BY P. CARRAGEA, IOWA STATE UNIV.
##Enter the function prop.ci used to calculate the 
##confidence interval for a population proportion using either 
##the Wilson score method or normal approximation method
  prop.ci<- function(y, n, type, conf.level){
    phat<- y/n
    alpha<- 1 - conf.level
    z<- qnorm(1 - alpha/2)
    newy<- y + z^2/2
    newn<- n + z^2
    newphat<- newy/newn
  
    if (type=="normal") {
      lowerci<- phat - z*sqrt(phat*(1-phat)/n)
      upperci<- phat + z*sqrt(phat*(1-phat)/n)
    }
  
    else if (type=="score") {
      lowerci<- (phat + (1/(2*n))*z^2 - z*sqrt(phat*(1-phat)/n + z^2/(4*n^2)))/(1 + (1/n)*z^2)
      upperci<- (phat + (1/(2*n))*z^2 + z*sqrt(phat*(1-phat)/n + z^2/(4*n^2)))/(1 + (1/n)*z^2)
    }
  
    else {
      lowerci<- newphat - z*sqrt(newphat*(1-newphat)/newn)
      upperci<- newphat + z*sqrt(newphat*(1-newphat)/newn)
    }
    cat(lowerci, upperci, "\n")
  }

##Enter the function nprop.ci used to calculate the sample size
##necessary for a confidence interval with a given margin of 
##error and confidence level
  nprop.ci<- function(p, m, conf.level) {
    alpha<- 1 - conf.level
    z<- qnorm(1 - alpha/2)
    ceiling((z/m)^2*p*(1-p))
  }

#############################################################################################################
## END P CARRAGEA CODE



```

1. According to a Gallup poll, of 1,000 randomly selected adults aged 18 or older in the United States, 65% believe that global warming is more a result of human actions than natural causes.

|      (a) Use R to obtain a summary table and bar graph of the sample data.

```{r q1a}

warming <- as.factor(c(rep('yes', 650), rep('no',350)))
df <- data.frame(warming)
tab1(df$warming, graph=FALSE, cum.percent = FALSE)

df %>% ggplot(aes(x=warming))+
    geom_bar(fill = "steelblue", colour = "black")+
    ylim(0, 800)+
    labs(x = "Belief",
         y = "Number of People",
         title = "Belief that global Warming is caused by people")+
    theme_bw()+
    theme(axis.title.y = element_text(size = rel(1.2)),
          axis.title.x = element_text(size = rel(1.2)),
          axis.text.x = element_text(size = rel(1.4)),
          axis.text.y = element_text(size = rel(1.4)),
          plot.title = element_text(hjust=0.5, size = rel(1.5)))
```



|      (b) Describe the population proportion of interest p in words.

**In this example, the population proportion (p) is the faction of the entire US population that believes global warming is caused more by people than natural causes. 



|      (c) Use R to calculate a 95% confidence interval for the population proportion p using the normal approximation method.

```{r}
prop.ci(650,1000,type="normal", 0.95)
```




|      (d) Give the interpretation of the 95% confidence interval you calculated in part (c) in the context of the problem. 

We are 95% confident that the true population proportion of people in the USE who believe global warming is caused more by people than nature is between 62.04% to approximately 67.95%.





|      (e) Use R to calculate a 95% confidence interval for the population proportion p using the Wilsonâ€™s score method. Compare the center and width of this interval to the one you calculated in part (c).


```{r}
prop.ci(650,1000,type="score", 0.95)


(.6795623+.6204377)/2
(.6789373+.6199147)/2

```

The results of the score method have a slightly smaller range than the results of the normal approxmation method. I would call the centers for each calculation approximately equal at .65. 



|      (f) Gallup is planning to conduct another poll on global warming. They would like to have a 95% confidence interval with a margin of error of no more than 2.5%. What sample size do they need to obtain this margin of error? Make sure to specify how you are calculating the sample size 

```{r}

cat("Sample size needed:",nprop.ci(.65,0.025,0.95))

```

To calculate the sample size, we solve for $n\geq (\frac{z_{1-\frac{\alpha}{2}}}{M})^2 \hat{\hat{p}}*(1-\hat{\hat{p}})$. Because this is a follow up survey, the reasearches might use their prior findings to estimate $\hat{\hat{p}}=.65$. 


